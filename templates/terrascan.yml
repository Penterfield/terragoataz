steps:
- script: |
    curl --location https://github.com/accurics/terrascan/releases/download/v1.3.2/terrascan_1.3.2_Linux_x86_64.tar.gz --output terrascan.tar.gz
    tar -xvf terrascan.tar.gz
    sudo install terrascan /usr/local/bin    
  displayName: 'Install Terrascan'

- bash: |
    cd terraform/azure
    terrascan scan -t azure --format template --template "@templates/junit.tpl" -o junit-report.xml
  displayName: 'Run Terrascan'   

- task: PublishTestResults@2
  displayName: "Terrascan Issues"
  inputs:
    testResultsFormat: 'JUnit'
    testResultsFiles: '**/junit-report.xml'
    mergeTestResults: true
    failTaskOnFailedTests: false
    testRunTitle: 'Terrascan Vulnerabilities'
  condition: 'always()'
 
  
