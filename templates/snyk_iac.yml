steps:
- task: Npm@1
  displayName: 'npm install'
  inputs:
    workingDir: .
    verbose: false

- task: SnykSecurityScan@0
  displayName: 'Snyk IaC Security Scan'
  inputs:
    serviceConnectionEndpoint: 'Snyk'
    bash: |
      mkdir snyk
      snyk iac test --severity-threshold=high --json-file-output=snyk/iac-results.json
      exitCode=$?
      [[ $exitCode = 0 ]] && state="success" || state="failure"
      echo "##vso[task.setvariable variable=SnykScaState;]$state"
      exit $exitCode


